# リファクタリングタスク向けプロンプト

## 前提条件

- 作業前に `git checkout main && git pull origin main` で最新化すること
- 新しいブランチを作成してから作業を開始すること
- このプロジェクトは発展途上であり、開発時の理解・デバッグを重視する

## 作業手順

### 1. 現状調査

- `docs/ARCHITECTURE.md` を最初に読み、システム全体を理解する
- 関連ファイルを読み込み、現在の構成を把握する
- 公式ドキュメント（Context7 の querydocs）で推奨構成を確認する
- deepwiki は `maxDepth: 0` で必要な情報のみ取得する

### 2. 仕様確認（重要）

- **推測で実装を進めない**
- 不明点があれば確認する
- ライブラリの API は必ず公式ドキュメントで確認する
- 「なぜこの変更が必要か」を説明できない場合は、その変更は不要

### 3. 問題の自己検証

以下の観点で検証し、確実な問題のみ対応する：

- **「なぜ問題か？」** - 具体的な理由を説明できるか
- **「本当に問題か？」** - 動作に影響があるか、単なる最適化か
- **「どうやって確認するか？」** - 変更前後で検証可能か
- **「開発者には何が必要か？」** - 実際のユースケースを考える

探究的に「なぜ？」「本当に？」と自問自答すること。

### 4. 変更の実施

- 論理的な単位でコミットを分離する
- 各コミットは以下の形式で記述：
  ```
  <type>(<scope>): <subject>

  - 変更点1
  - 変更点2

  理由や背景（必要に応じて）
  ```
- type: feat, fix, refactor, docs, chore, perf

### 5. 検証

- `bun run typecheck` - 型チェック
- `bun run check` - Biome lint/format
- `bun run build` - ビルド確認
- 関連ドキュメント（*.md, *.json）に古い参照が残っていないか grep で確認

### 6. 漏れチェック

```bash
grep -r "検索キーワード" --include="*.md" --include="*.json" --include="*.ts" | grep -v node_modules
```

### 7. PR 作成

- ブランチ名: `<type>/<簡潔な説明>`
- PR 本文に概要・変更内容・検証結果を記載

---

## 過去の作業から学んだ教訓

### 良かった点

1. **自己検証の実施**
   - 「本当に問題か？」「なぜ？」と探究的に考えることで、誤った分析を修正できた
   - 例: `@theme` と `@theme inline` の違いを調査し、単純統合の危険性を発見

2. **段階的なコミット**
   - 論理的な単位でコミットを分離（パッケージ変更 → 設定整理 → ドキュメント）
   - 各コミットが独立してレビュー可能

3. **漏れチェック**
   - `grep` で参照を検索し、設定ファイルの漏れを発見

4. **公式ドキュメントの確認**
   - Context7 で API を確認し、誤った実装を防止

### 悪かった点

1. **推測での実装**
   - ライブラリの API を確認せずに実装例を書いた
   - 例: loglevel の API を間違えた（第二引数を受け付けない）

2. **アーキテクチャ理解の後回し**
   - `docs/ARCHITECTURE.md` を読まずにファイルを選定した
   - 全体像を把握してから詳細に入るべき

3. **単純置換の罠**
   - 「console.* を logger.* に置換」と考えたが、それでは意味がない
   - 各ログポイントで「なぜ必要か」を考える必要がある

4. **過剰設計 / 過小設計の判断ミス**
   - 最初は「簡易ラッパーで十分」と判断したが、プロジェクトの成熟度を考慮していなかった
   - 発展途上のプロジェクトでは、問題調査のためのログが重要

5. **deepwiki の過剰な情報取得**
   - `maxDepth: 1` でコンテキストが圧縮され、再調査が必要になった

6. **git 操作のミス**
   - 作業ブランチが main ではなく古いブランチだった
   - 一度リセットしてやり直しが必要になった

---

## 注意事項

- 単純に見える重複でも、意味の違いがないか確認する
- 設定ファイルの削除前に、実際に読み込まれているか確認する
- git 操作前に `git status` で状態を確認する
- 競合が発生したら無理に解決せず、リセットしてやり直す
- **変更対象ファイルのリストを事前に決めない** - 調査結果に基づいて判断する
- **.env.example の更新を忘れない** - 環境変数を追加した場合

---

## プロジェクト固有のルール

- Bun を使用（`bun install`, `bun run dev`）
- Biome でリント/フォーマット（`bun run check`）
- Hono RPC で型安全な通信
- Backend の相対インポートには `.js` 拡張子が必要
- コミットメッセージは日本語で記述
